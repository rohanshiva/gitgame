{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/gitgame/gitgame/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/gitgame/gitgame/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/gitgame/gitgame/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useContext,useState}from\"react\";import{useHistory}from\"react-router-dom\";import Notification,{SUCCESS,LOADING,toastWithId,NotificationDisplay}from\"../notifications/Notification\";import Editor from\"../editor\";import toast from\"react-hot-toast\";import\"./Game.css\";import CommentSider from\"../commentSider\";import DisconnectionModal from\"./disconnection/DisconnectionModal\";import useGameConnection from\"./hooks/gameConnection/UseGameConnection\";import Lobby from\"./lobby/Lobby\";import UserContext from\"../../context/UserContext\";import CommentHighlightContext from\"../../context/CommentHighlightContext\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function getSessionId(path){var pathParts=path.split(\"/\");return pathParts[pathParts.length-1];}function Game(){var history=useHistory();var sessionId=getSessionId(history.location.pathname);var _useContext=useContext(UserContext),user=_useContext.user;var username=user===null||user===void 0?void 0:user.username;var _useState=useState(),_useState2=_slicedToArray(_useState,2),commentHighlight=_useState2[0],setCommentHighlight=_useState2[1];var dehighlight=function dehighlight(){return setCommentHighlight(undefined);};var onAlert=useCallback(function(alert){toast(alert,SUCCESS);},[]);var _useGameConnection=useGameConnection(sessionId,onAlert),state=_useGameConnection.state,actions=_useGameConnection.actions,disconnection=_useGameConnection.disconnection;var source_code=state.source_code,players=state.players,new_comments=state.new_comments,comments=state.comments;var isDisconnected=disconnection.isDisconnected,disconnectionMessage=disconnection.disconnectionMessage;var copyHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return navigator.clipboard.writeText(sessionId);case 2:toast(\"Session code copied \".concat(sessionId,\"!\"),SUCCESS);case 3:case\"end\":return _context.stop();}},_callee);}));return function copyHandler(){return _ref.apply(this,arguments);};}();var nextHandler=function nextHandler(){toast(\"Fetching next chunk\",toastWithId(LOADING,NotificationDisplay.NEXT_ROUND));actions.pickSourceCode();};var addCommentHandler=function addCommentHandler(comment){actions.addComment(comment);};var isHost=function isHost(username){return username===state.host;};var isYouHost=isHost(username);//todo(Ramko9999): disable any interaction on the lobby chunk\nreturn/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"top\",children:[/*#__PURE__*/_jsx(\"a\",{href:source_code.file_visit_url,target:\"_blank\",children:source_code.file_display_path}),/*#__PURE__*/_jsxs(\"div\",{className:\"top-right\",children:[/*#__PURE__*/_jsx(Lobby,{players:players,locationUser:username}),/*#__PURE__*/_jsxs(\"div\",{className:\"top-btns\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:nextHandler,disabled:!isYouHost,children:\"Next\"}),/*#__PURE__*/_jsx(\"button\",{onClick:copyHandler,children:\"Copy\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mid\",children:/*#__PURE__*/_jsxs(CommentHighlightContext.Provider,{value:{commentHighlight:commentHighlight,highlightComment:setCommentHighlight,dehighlight:dehighlight},children:[/*#__PURE__*/_jsx(Editor,{code:source_code,newComments:new_comments,onNewCommentAck:actions.ackNewComment,addComment:addCommentHandler}),/*#__PURE__*/_jsx(CommentSider,{comments:comments})]})}),/*#__PURE__*/_jsx(Notification,{}),/*#__PURE__*/_jsx(DisconnectionModal,{shouldOpen:isDisconnected,message:disconnectionMessage})]});}export default Game;","map":{"version":3,"names":["useCallback","useContext","useState","useHistory","Notification","SUCCESS","LOADING","toastWithId","NotificationDisplay","Editor","toast","CommentSider","DisconnectionModal","useGameConnection","Lobby","UserContext","CommentHighlightContext","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","getSessionId","path","pathParts","split","length","Game","history","sessionId","location","pathname","_useContext","user","username","_useState","_useState2","_slicedToArray","commentHighlight","setCommentHighlight","dehighlight","undefined","onAlert","alert","_useGameConnection","state","actions","disconnection","source_code","players","new_comments","comments","isDisconnected","disconnectionMessage","copyHandler","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","navigator","clipboard","writeText","concat","stop","apply","arguments","nextHandler","NEXT_ROUND","pickSourceCode","addCommentHandler","comment","addComment","isHost","host","isYouHost","children","className","href","file_visit_url","target","file_display_path","locationUser","onClick","disabled","Provider","value","highlightComment","code","newComments","onNewCommentAck","ackNewComment","shouldOpen","message"],"sources":["/home/runner/work/gitgame/gitgame/client/src/components/game/Game.tsx"],"sourcesContent":["import { useCallback, useContext, useState, useEffect } from \"react\";\n\nimport { useHistory } from \"react-router-dom\";\nimport Notification, {\n  SUCCESS,\n  LOADING,\n  toastWithId,\n  NotificationDisplay,\n} from \"../notifications/Notification\";\nimport Editor from \"../editor\";\nimport toast from \"react-hot-toast\";\nimport \"./Game.css\";\nimport { AddComment } from \"../../Interface\";\nimport CommentSider from \"../commentSider\";\nimport DisconnectionModal from \"./disconnection/DisconnectionModal\";\nimport useGameConnection from \"./hooks/gameConnection/UseGameConnection\";\nimport Lobby from \"./lobby/Lobby\";\nimport UserContext from \"../../context/UserContext\";\nimport CommentHighlightContext, {\n  CommentHighlight,\n} from \"../../context/CommentHighlightContext\";\n\nfunction getSessionId(path: string) {\n  const pathParts = path.split(\"/\");\n  return pathParts[pathParts.length - 1];\n}\n\nfunction Game() {\n  const history = useHistory();\n  const sessionId = getSessionId(history.location.pathname);\n  const { user } = useContext(UserContext);\n  const username = user?.username as string;\n\n  const [commentHighlight, setCommentHighlight] =\n    useState<CommentHighlight>();\n\n  const dehighlight = () => setCommentHighlight(undefined);\n\n  const onAlert = useCallback((alert: string) => {\n    toast(alert, SUCCESS as any);\n  }, []);\n\n  const { state, actions, disconnection } = useGameConnection(\n    sessionId,\n    onAlert\n  );\n\n  const { source_code, players, new_comments, comments } = state;\n\n  const { isDisconnected, disconnectionMessage } = disconnection;\n\n  const copyHandler = async () => {\n    await navigator.clipboard.writeText(sessionId);\n    toast(`Session code copied ${sessionId}!`, SUCCESS as any);\n  };\n\n  const nextHandler = () => {\n    toast(\n      \"Fetching next chunk\",\n      toastWithId(LOADING, NotificationDisplay.NEXT_ROUND)\n    );\n    actions.pickSourceCode();\n  };\n\n  const addCommentHandler = (comment: AddComment) => {\n    actions.addComment(comment);\n  };\n\n  const isHost = (username: string) => username === state.host;\n  const isYouHost = isHost(username);\n\n  //todo(Ramko9999): disable any interaction on the lobby chunk\n  return (\n    <>\n      <div className=\"top\">\n        <a href={source_code.file_visit_url} target=\"_blank\">\n          {source_code.file_display_path}\n        </a>\n        <div className=\"top-right\">\n          <Lobby players={players} locationUser={username} />\n          <div className=\"top-btns\">\n            <button onClick={nextHandler} disabled={!isYouHost}>\n              Next\n            </button>\n            <button onClick={copyHandler}>Copy</button>\n          </div>\n        </div>\n      </div>\n      <div className=\"mid\">\n        <CommentHighlightContext.Provider\n          value={{\n            commentHighlight,\n            highlightComment: setCommentHighlight,\n            dehighlight,\n          }}\n        >\n          <Editor\n            code={source_code}\n            newComments={new_comments}\n            onNewCommentAck={actions.ackNewComment}\n            addComment={addCommentHandler}\n          />\n          <CommentSider comments={comments}/>\n        </CommentHighlightContext.Provider>\n      </div>\n      <Notification />\n      <DisconnectionModal\n        shouldOpen={isDisconnected}\n        message={disconnectionMessage as string}\n      />\n    </>\n  );\n}\n\nexport default Game;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}